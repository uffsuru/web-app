<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}AuctionHub - Bid, Win, Enjoy{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {% block stylesheets %}{# Page-specific stylesheets will go here #}{% endblock %}
     <style>
        .notifications {
            position: relative;
            display: inline-block;
        }

        .notification-bell {
            cursor: pointer;
            font-size: 1.5rem;
            color: #333;
        }

        .notification-count {
            position: absolute;
            top: -5px;
            right: -10px;
            background-color: red;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .notifications-dropdown {
            display: none;
            position: absolute;
            right: 0;
            background-color: white;
            min-width: 300px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
        }

        .notifications-dropdown a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            border-bottom: 1px solid #f1f1f1;
        }

        .notifications-dropdown a:hover {
            background-color: #f1f1f1;
        }

        .notification-item.unread {
            background-color: #f0f8ff;
        }
    </style>
</head>
<body>

<header>
    <div class="container">
        <nav>
            <div class="logo">
                <a href="{{ url_for('index') }}">AuctionHub</a>
            </div>
            <ul class="nav-links" id="navLinks">
                <li><a href="{{ url_for('index', _anchor='home') }}">Home</a></li>
                <li><a href="{{ url_for('index', _anchor='auctions') }}">Auctions</a></li>
                {% if session.user_id %}
                    <li><a href="{{ url_for('create_auction') }}">Create Auction</a></li>
                    <li><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
                    <li><a href="{{ url_for('profile') }}">Profile</a></li>
                {% endif %}
                {% if session.is_admin %}
                    <li><a href="{{ url_for('admin_dashboard') }}" style="color: #e74c3c; font-weight: bold;">Admin Panel</a></li>
                {% endif %}
                <li><a href="{{ url_for('index', _anchor='help') }}">Help</a></li>
            </ul>
            <div class="auth-buttons">
                {% if session.user_id %}
                    <div class="notifications">
                        <span class="notification-bell">ðŸ””</span>
                        <span class="notification-count" id="notification-count" style="display: none;">0</span>
                        <div class="notifications-dropdown" id="notifications-dropdown">
                            <!-- Notification items will be inserted here by JavaScript -->
                            <div id="notification-placeholder" style="padding: 12px 16px; color: #666;">Loading...</div>
                        </div>
                    </div>
                    <span class="user-welcome">Hi, {{ session.user_name }}!</span>
                    <a href="{{ url_for('logout') }}" class="btn btn-secondary">Logout</a>
                {% else %}
                    <button id="loginBtn" class="btn btn-secondary">Login</button>
                    <button id="registerBtn" class="btn btn-primary">Register</button>
                {% endif %}
            </div>
            <button class="mobile-nav-toggle" id="mobileNavToggle">â˜°</button>
        </nav>
    </div>
</header>

<main>
    {% block content %}{% endblock %}
</main>

<footer>
    <div class="container">
        <p>&copy; AuctionHub. All Rights Reserved.</p>
    </div>
</footer>

<!-- Login Modal -->
<div id="loginModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeLoginModal">&times;</span>
        <h2>Login</h2>
        <div id="loginError" style="color: red; margin-bottom: 1rem; display: none;"></div>
        <form id="loginForm">
            <div class="form-group">
                <label for="loginEmail">Email</label>
                <input type="email" id="loginEmail" required>
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
        </form>
    </div>
</div>

<!-- Register Modal -->
<div id="registerModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeRegisterModal">&times;</span>
        <h2>Register</h2>
        <div id="registerError" style="color: red; margin-bottom: 1rem; display: none;"></div>
        <form id="registerForm">
            <div class="form-group">
                <label for="registerName">Name</label>
                <input type="text" id="registerName" required>
            </div>
            <div class="form-group">
                <label for="registerEmail">Email</label>
                <input type="email" id="registerEmail" required>
            </div>
            <div class="form-group">
                <label for="registerPassword">Password</label>
                <input type="password" id="registerPassword" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Register</button>
        </form>
    </div>
</div>

<script>
    // Pass URLs from Flask to JavaScript for global use
    const appConfig = {
        loginUrl: "{{ url_for('login') }}",
        registerUrl: "{{ url_for('register') }}",
        markReadUrl: "{{ url_for('mark_notifications_as_read') }}",
        summaryUrl: "{{ url_for('notifications_summary') }}"
    };
</script>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script src="https://cdn.socket.io/4.5.2/socket.io.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    {% if session.user_id %}
    // This part remains inline as it requires server-side session data
    var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port);
    socket.on('connect', function() {
        socket.emit('join', {room: '{{ session.user_id }}'});
    });

    socket.on('new_notification', function(notification) {
        const notificationCount = document.getElementById('notification-count');
        const notificationsDropdown = document.getElementById('notifications-dropdown');

        const count = parseInt(notificationCount.textContent) + 1;
        notificationCount.textContent = count;
        notificationCount.style.display = 'block';

        const newNotification = document.createElement('a');
        newNotification.href = notification.link;
        newNotification.className = 'notification-item unread';
        newNotification.textContent = notification.message;
        if (notificationsDropdown) notificationsDropdown.prepend(newNotification);
    });
    {% endif %}
});
</script>
{% block scripts %}{% endblock %}

</body>
</html>